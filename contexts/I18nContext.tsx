import React, { createContext, useContext, useState, useEffect } from 'react';

export type Language = 'en' | 'es' | 'fr' | 'de' | 'pt' | 'ja' | 'zh';

interface I18nContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string) => string;
}

const I18nContext = createContext<I18nContextType | undefined>(undefined);

const TRANSLATIONS: Record<Language, Record<string, string>> = {
  en: {
    'app.title': 'WoW AI Class Helper',
    'app.description': 'AI-powered World of Warcraft class guides',
    'common.back': 'Back',
    'common.loading': 'Loading...',
    'common.error': 'Error',
    'role.user': 'User Mode',
    'role.master': 'Master Mode',
    'role.admin': 'Admin Mode',
    'role.all': 'All',
    'role.tank': 'Tank',
    'role.healer': 'Healer',
    'role.damage': 'Damage',
    'armor.cloth': 'Cloth',
    'armor.leather': 'Leather',
    'armor.mail': 'Mail',
    'armor.plate': 'Plate',
    'difficulty.easy': 'Easy',
    'difficulty.moderate': 'Moderate',
    'difficulty.hard': 'Hard',
    'filter.armor': 'Armor Type',
    'filter.difficulty': 'Difficulty',
    'filter.moreFilters': 'Advanced Filters',
    'selection.title': 'Select Your Class',
    'selection.subtitle': 'Choose your class to get AI-powered guides, tips, and strategies.',
    'selection.searchPlaceholder': 'Search classes...',
    'selection.noResults': 'No classes found matching your criteria.',
    'selection.clearFilters': 'Clear Filters',
    'tab.overview': 'Overview',
    'tab.specs': 'Specs',
    'tab.rotations': 'Rotations',
    'tab.addons': 'Addons',
    'tab.dungeons': 'Dungeons',
    'tab.videos': 'Videos',
    'hub.allExpansions': 'All Expansions',
    'hub.loadingGuide': 'Loading guide...',
    'hub.failedToLoad': 'Failed to load guide content. Please try again.',
    'pwa.offlineReady': 'App ready to work offline',
    'pwa.newContent': 'New content available, click on reload button to update.',
    'pwa.reload': 'Reload',
    'common.close': 'Close',
    'a11y.skipToContent': 'Skip to main content',
  },
  es: {
    'app.title': 'Asistente de Clases WoW IA',
    'app.description': 'Guías de clases de World of Warcraft impulsadas por IA',
    'common.back': 'Volver',
    'common.loading': 'Cargando...',
    'common.error': 'Error',
    'role.user': 'Modo Usuario',
    'role.master': 'Modo Maestro',
    'role.admin': 'Modo Admin',
    'role.all': 'Todos',
    'role.tank': 'Tanque',
    'role.healer': 'Sanador',
    'role.damage': 'Daño',
    'armor.cloth': 'Tela',
    'armor.leather': 'Cuero',
    'armor.mail': 'Malla',
    'armor.plate': 'Placas',
    'difficulty.easy': 'Fácil',
    'difficulty.moderate': 'Moderado',
    'difficulty.hard': 'Difícil',
    'filter.armor': 'Tipo de Armadura',
    'filter.difficulty': 'Dificultad',
    'filter.moreFilters': 'Filtros Avanzados',
    'selection.title': 'Selecciona tu Clase',
    'selection.subtitle': 'Elige tu clase para obtener guías, consejos y estrategias impulsadas por IA.',
    'selection.searchPlaceholder': 'Buscar clases...',
    'selection.noResults': 'No se encontraron clases que coincidan con tus criterios.',
    'selection.clearFilters': 'Limpiar Filtros',
    'tab.overview': 'Resumen',
    'tab.specs': 'Especializaciones',
    'tab.rotations': 'Rotaciones',
    'tab.addons': 'Addons',
    'tab.dungeons': 'Mazmorras',
    'tab.videos': 'Videos',
    'hub.allExpansions': 'Todas las Expansiones',
    'hub.loadingGuide': 'Cargando guía...',
    'hub.failedToLoad': 'Error al cargar el contenido de la guía. Por favor, inténtalo de nuevo.',
    'pwa.offlineReady': 'App lista para trabajar sin conexión',
    'pwa.newContent': 'Nuevo contenido disponible, haz clic en recargar para actualizar.',
    'pwa.reload': 'Recargar',
    'common.close': 'Cerrar',
    'a11y.skipToContent': 'Saltar al contenido principal',
  },
  fr: {
    'app.title': 'Assistant de Classe WoW IA',
    'app.description': 'Guides de classe World of Warcraft alimentés par IA',
    'common.back': 'Retour',
    'common.loading': 'Chargement...',
    'common.error': 'Erreur',
    'role.user': 'Mode Utilisateur',
    'role.master': 'Mode Maître',
    'role.admin': 'Mode Admin',
    'role.all': 'Tous',
    'role.tank': 'Tank',
    'role.healer': 'Soigneur',
    'role.damage': 'Dégâts',
    'armor.cloth': 'Tissu',
    'armor.leather': 'Cuir',
    'armor.mail': 'Mailles',
    'armor.plate': 'Plaques',
    'difficulty.easy': 'Facile',
    'difficulty.moderate': 'Modéré',
    'difficulty.hard': 'Difficile',
    'filter.armor': 'Type d\'Armure',
    'filter.difficulty': 'Difficulté',
    'filter.moreFilters': 'Filtres Avancés',
    'selection.title': 'Sélectionnez votre Classe',
    'selection.subtitle': 'Choisissez votre classe pour obtenir des guides, conseils et stratégies alimentés par IA.',
    'selection.searchPlaceholder': 'Rechercher des classes...',
    'selection.noResults': 'Aucune classe trouvée correspondant à vos critères.',
    'selection.clearFilters': 'Effacer les filtres',
    'tab.overview': 'Aperçu',
    'tab.specs': 'Spécialisations',
    'tab.rotations': 'Rotations',
    'tab.addons': 'Addons',
    'tab.dungeons': 'Donjons',
    'tab.videos': 'Vidéos',
    'hub.allExpansions': 'Toutes les extensions',
    'hub.loadingGuide': 'Chargement du guide...',
    'hub.failedToLoad': 'Échec du chargement du guide. Veuillez réessayer.',
  },
  de: {
    'app.title': 'WoW KI-Klassenassistent',
    'app.description': 'KI-gestützte World of Warcraft-Klassenleitfäden',
    'common.back': 'Zurück',
    'common.loading': 'Laden...',
    'common.error': 'Fehler',
    'role.user': 'Benutzermodus',
    'role.master': 'Meistermodus',
    'role.admin': 'Admin-Modus',
    'role.all': 'Alle',
    'role.tank': 'Tank',
    'role.healer': 'Heiler',
    'role.damage': 'Schaden',
    'armor.cloth': 'Stoff',
    'armor.leather': 'Leder',
    'armor.mail': 'Kette',
    'armor.plate': 'Platte',
    'difficulty.easy': 'Einfach',
    'difficulty.moderate': 'Mittel',
    'difficulty.hard': 'Schwer',
    'filter.armor': 'Rüstungsklasse',
    'filter.difficulty': 'Schwierigkeit',
    'filter.moreFilters': 'Erweiterte Filter',
    'selection.title': 'Wähle deine Klasse',
    'selection.subtitle': 'Wähle deine Klasse für KI-gestützte Guides, Tipps und Strategien.',
    'selection.searchPlaceholder': 'Klassen suchen...',
    'selection.noResults': 'Keine Klassen gefunden, die deinen Kriterien entsprechen.',
    'selection.clearFilters': 'Filter zurücksetzen',
    'tab.overview': 'Übersicht',
    'tab.specs': 'Spezialisierungen',
    'tab.rotations': 'Rotationen',
    'tab.addons': 'Addons',
    'tab.dungeons': 'Dungeons',
    'tab.videos': 'Videos',
    'hub.allExpansions': 'Alle Erweiterungen',
    'hub.loadingGuide': 'Lade Guide...',
    'hub.failedToLoad': 'Fehler beim Laden des Guides. Bitte versuche es erneut.',
  },
  pt: {
    'app.title': 'Assistente de Classe WoW IA',
    'app.description': 'Guias de classe World of Warcraft alimentadas por IA',
    'common.back': 'Voltar',
    'common.loading': 'Carregando...',
    'common.error': 'Erro',
    'role.user': 'Modo Usuário',
    'role.master': 'Modo Mestre',
    'role.admin': 'Modo Admin',
    'role.all': 'Todos',
    'role.tank': 'Tanque',
    'role.healer': 'Curador',
    'role.damage': 'Dano',
    'armor.cloth': 'Tecido',
    'armor.leather': 'Couro',
    'armor.mail': 'Malha',
    'armor.plate': 'Placas',
    'difficulty.easy': 'Fácil',
    'difficulty.moderate': 'Moderado',
    'difficulty.hard': 'Difícil',
    'filter.armor': 'Tipo de Armadura',
    'filter.difficulty': 'Dificuldade',
    'filter.moreFilters': 'Filtros Avançados',
    'selection.title': 'Selecione sua Classe',
    'selection.subtitle': 'Escolha sua classe para obter guias, dicas e estratégias alimentadas por IA.',
    'selection.searchPlaceholder': 'Pesquisar classes...',
    'selection.noResults': 'Nenhuma classe encontrada com seus critérios.',
    'selection.clearFilters': 'Limpar Filtros',
    'tab.overview': 'Visão Geral',
    'tab.specs': 'Especializações',
    'tab.rotations': 'Rotações',
    'tab.addons': 'Addons',
    'tab.dungeons': 'Masmorras',
    'tab.videos': 'Vídeos',
    'hub.allExpansions': 'Todas as Expansões',
    'hub.loadingGuide': 'Carregando guia...',
    'hub.failedToLoad': 'Falha ao carregar o conteúdo do guia. Por favor, tente novamente.',
  },
  ja: {
    'app.title': 'WoW AI クラスヘルパー',
    'app.description': 'AI搭載のWorld of Warcraftクラスガイド',
    'common.back': '戻る',
    'common.loading': '読み込み中...',
    'common.error': 'エラー',
    'role.user': 'ユーザーモード',
    'role.master': 'マスターモード',
    'role.admin': '管理者モード',
    'role.all': 'すべて',
    'role.tank': 'タンク',
    'role.healer': 'ヒーラー',
    'role.damage': 'ダメージ',
    'armor.cloth': '布',
    'armor.leather': '革',
    'armor.mail': '鎖',
    'armor.plate': '板金',
    'difficulty.easy': '簡単',
    'difficulty.moderate': '普通',
    'difficulty.hard': '難しい',
    'filter.armor': 'アーマータイプ',
    'filter.difficulty': '難易度',
    'filter.moreFilters': '詳細フィルター',
    'selection.title': 'クラスを選択',
    'selection.subtitle': 'AI搭載のガイド、ヒント、戦略を取得するためにクラスを選択してください。',
    'selection.searchPlaceholder': 'クラスを検索...',
    'selection.noResults': '条件に一致するクラスが見つかりませんでした。',
    'selection.clearFilters': 'フィルターをクリア',
    'tab.overview': '概要',
    'tab.specs': 'スペシャライゼーション',
    'tab.rotations': 'ローテーション',
    'tab.addons': 'アドオン',
    'tab.dungeons': 'ダンジョン',
    'tab.videos': 'ビデオ',
    'hub.allExpansions': 'すべての拡張',
    'hub.loadingGuide': 'ガイドを読み込んでいます...',
    'hub.failedToLoad': 'ガイドコンテンツの読み込みに失敗しました。もう一度お試しください。',
  },
  zh: {
    'app.title': 'WoW AI 职业助手',
    'app.description': 'AI驱动的魔兽世界职业指南',
    'common.back': '返回',
    'common.loading': '加载中...',
    'common.error': '错误',
    'role.user': '用户模式',
    'role.master': '大师模式',
    'role.admin': '管理员模式',
    'role.all': '全部',
    'role.tank': '坦克',
    'role.healer': '治疗',
    'role.damage': '输出',
    'armor.cloth': '布甲',
    'armor.leather': '皮甲',
    'armor.mail': '锁甲',
    'armor.plate': '板甲',
    'difficulty.easy': '简单',
    'difficulty.moderate': '中等',
    'difficulty.hard': '困难',
    'filter.armor': '护甲类型',
    'filter.difficulty': '难度',
    'filter.moreFilters': '高级筛选',
    'selection.title': '选择你的职业',
    'selection.subtitle': '选择你的职业以获取AI驱动的指南、提示和策略。',
    'selection.searchPlaceholder': '搜索职业...',
    'selection.noResults': '未找到符合条件的职业。',
    'selection.clearFilters': '清除筛选',
    'tab.overview': '概览',
    'tab.specs': '专精',
    'tab.rotations': '循环',
    'tab.addons': '插件',
    'tab.dungeons': '地下城',
    'tab.videos': '视频',
    'hub.allExpansions': '所有资料片',
    'hub.loadingGuide': '正在加载指南...',
    'hub.failedToLoad': '加载指南内容失败。请重试。',
  },
};

interface I18nProviderProps {
  children: React.ReactNode;
  defaultLanguage?: Language;
}

export const I18nProvider: React.FC<I18nProviderProps> = ({ children, defaultLanguage = 'en' }) => {
  const [language, setLanguageState] = useState<Language>(() => {
    const stored = localStorage.getItem('wow_class_helper_language');
    if (stored && Object.keys(TRANSLATIONS).includes(stored)) {
      return stored as Language;
    }
    return defaultLanguage;
  });

  useEffect(() => {
    localStorage.setItem('wow_class_helper_language', language);
    document.documentElement.lang = language;
  }, [language]);

  const setLanguage = (lang: Language) => {
    setLanguageState(lang);
  };

  const t = (key: string): string => {
    return TRANSLATIONS[language][key] || TRANSLATIONS.en[key] || key;
  };

  return (
    <I18nContext.Provider value={{ language, setLanguage, t }}>{children}</I18nContext.Provider>
  );
};

export const useI18n = (): I18nContextType => {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error('useI18n must be used within I18nProvider');
  }
  return context;
};
